context("INR Inference")

test_that("test.inr.inference", {
library(eventstudies)

load(system.file("data", "inr.rda",package = "eventstudies"))

inr_returns <- diff(log(inr))[-1]

eventslist <- data.frame(unit=rep("inr",10),
                         when=as.Date(c(
                           "2010-04-20","2010-07-02","2010-07-27",
                           "2010-09-16","2010-11-02","2011-01-25",
                           "2011-03-17","2011-05-03","2011-06-16",
                           "2011-07-26")
                           )
                         )

event_time_data <- phys2eventtime(inr_returns,eventslist,width=10)
w <- window(event_time_data$z.e,start=-10,end=10)

expect_that(inference.Ecar(w)[,2],
                         equals(c(-0.00215361156303362, -0.00040191670837042, 0.00171845148444985, 
                           0.00143799970419951, 0.00149260146357282, -0.00284892904228684, 
                           0.0013220811191847, -0.000634983205805195, 0.00115930378269389, 
                           -0.000508755768685365, -0.00190621828611177, 0.000128303517790052, 
                           -0.000547070723466092, 0.000463708708964017, -0.00108666428087325, 
                           -0.00121321855159642, 0.00216769754166339, -0.000166340225607797, 
                           0.00117626759805196, 0.000207307545758795, 0.000602629204764948
                           )))
})
